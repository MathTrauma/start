<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 처리 중...</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #1a1a2e;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .loader {
            text-align: center;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader">
        <div class="spinner"></div>
        <p>로그인 처리 중...</p>
    </div>

    <script>
        const SUPABASE_URL = 'https://bdunrluoivhgypwangcx.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJkdW5ybHVvaXZoZ3lwd2FuZ2N4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyNjc1NTksImV4cCI6MjA4Mjg0MzU1OX0.JBkLVuR8RyOmwMl6_-KPIgsYBy1_qoG90v5j_vt0mSQ';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function handleCallback() {
            try {
                // Supabase가 URL hash에서 토큰을 처리하도록 대기
                const { data: { session }, error } = await supabaseClient.auth.getSession();

                if (error) {
                    console.error('Auth error:', error);
                }

                // 저장된 원래 URL로 리다이렉트
                const redirectUrl = localStorage.getItem('authRedirect');
                localStorage.removeItem('authRedirect');

                if (redirectUrl) {
                    window.location.href = redirectUrl;
                } else {
                    // 저장된 URL이 없으면 홈으로
                    window.location.href = '/';
                }
            } catch (err) {
                console.error('Callback error:', err);
                window.location.href = '/';
            }
        }

        handleCallback();
    </script>
</body>
</html>
