<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euclidean Geometry Problem Viewer</title>

    <!-- Korean Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/mobile.css" media="(max-width: 768px)">
    <link rel="stylesheet" href="styles/tablet.css" media="(min-width: 769px) and (max-width: 1024px)">
    <link rel="stylesheet" href="styles/desktop.css" media="(min-width: 1025px)">

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "p5": "https://esm.sh/p5@1.9.4"
        }
    }
    </script>

    <!-- p5.js Preload Hint -->
    <link rel="modulepreload" href="https://esm.sh/p5@1.9.4">

    <!-- KaTeX (legacy) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <!-- MathJax (for canvas rendering) -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.469.0"></script>

    <!-- Supabase & Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>

</head>
<body>
    <!-- Top Navigation -->
    <header class="top-nav">
        <a href="./" class="nav-logo">
            <span>MathMore</span>
        </a>
        <select id="theme-select" class="theme-select" onchange="changeTheme(this.value)">
            <option value="chalkboard" selected>칠판</option>
            <option value="dark">어두운</option>
            <option value="sepia">세피아</option>
        </select>
        <div class="btn-group">
            <button id="rotate-btn" class="rotate-btn" onclick="rotateCanvas()" title="90° 회전">↻</button>
            <button id="bookmark-btn" class="bookmark-btn" onclick="toggleBookmark()" title="북마크" style="display: none;">
                <i data-lucide="bookmark"></i>
            </button>
        </div>
        <div class="auth-buttons">
            <button id="login-btn" onclick="signInWithGoogle()" style="display: none;">로그인</button>
            <button id="logout-btn" onclick="signOut()" style="display: none;">로그아웃</button>
        </div>
    </header>

    <!-- Main Viewer Content -->
    <main class="viewer-main">
        <!-- Problem Section -->
        <div id="problem-scroll-container">
            <div id="problem-container" class="problem-container">
                <!-- Problem content will be loaded here by JS -->
            </div>
        </div>

        <!-- Canvas Section -->
        <section class="canvas-section">
            <div id="canvas-wrapper" class="canvas-container">
                <!-- p5.js canvas will be inserted here -->
            </div>
        </section>

        <!-- Solution Section -->
        <div id="solution-scroll-container">
            <div id="solution-container" class="solution-container hidden">
                <div class="solution-container-content">
                    <div id="solution-text"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Viewer (Dynamic - Local or R2) -->
    <script>
        (function() {
            const isLocal = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            const src = isLocal
                ? 'lib/viewer-app.js'
                : 'https://euclide-worker.painfultrauma.workers.dev/lib/viewer-app.js';
            const script = document.createElement('script');
            script.type = 'module';
            script.src = src;
            document.body.appendChild(script);
        })();
    </script>
</body>
</html>
